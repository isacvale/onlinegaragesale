"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var stampData = {};
var aliasData = {};

var identity = x => x;

function StampData(selector) {
  this.selector = selector;
  this.template = document.querySelector(selector);
  this.target = this.template.parentElement;
  this.cap = Infinity;
  this.keep = 0;
  this.mutator = identity;
}

function createNewStamp(selector) {
  stampData[selector] = new StampData(selector);
}

function Stamp(selector) {
  var data = {};

  function count() {
    var query = "[data-_stamp=\"".concat(data.selector, "\"]");
    return data.target.querySelectorAll(query).length;
  }

  function deleteElements(list) {
    list.forEach((el, idx) => {
      if (idx >= data.keep) {
        el.parentElement.removeChild(el);
      }
    });
  }

  var api = {
    get(selector) {
      var lookup = aliasData[selector] ? aliasData[selector] : selector;

      if (!stampData[lookup]) {
        createNewStamp(lookup);
      }

      data = stampData[lookup];
      return this;
    },

    stamp(callback) {
      if (count() < data.cap) {
        var target = data.target;
        var clone = data.template.content.cloneNode(true);
        var cloneContent = clone.firstElementChild;
        data.mutator(cloneContent);
        cloneContent.setAttribute('data-_stamp', data.selector);
        target.append(clone);

        if (callback) {
          callback(target.lastElementChild);
        }
      }

      return this;
    },

    alias(alias) {
      aliasData[alias] = data.selector;
      return this;
    },

    change(mutator) {
      data.mutator = mutator;
      return this;
    },

    target(targetSelector) {
      data.target = document.querySelector(targetSelector);
      return this;
    },

    keep(keepAmount) {
      data.keep = keepAmount;
      return this;
    },

    cap(capAmount) {
      data.cap = capAmount;
      return this;
    },

    clear() {
      var query = "[data-_stamp=\"".concat(data.selector, "\"]");
      var stamps = data.target.querySelectorAll(query);
      deleteElements(stamps);
      return this;
    },

    clearAll() {
      var children = Array.from(data.target.children).filter(el => el.tagName !== 'TEMPLATE');
      deleteElements(children);
      return this;
    },

    execute(func) {
      func(this);
      return this;
    },

    debug() {
      var returnResult = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      if (!returnResult) console.debug('stamp data:', data);
      return returnResult ? data : this;
    }

  };
  if (selector) api.get(selector);
  return api;
}

var _default = Stamp;
exports.default = _default;